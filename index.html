<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    
    <!-- dataTables --> 
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/bs4/dt-1.10.18/b-1.5.4/b-html5-1.5.4/datatables.min.css"/>
    
    <!-- Le styles -->
    <link href="bootstrap-4.1.3-dist/css/bootstrap.css" rel="stylesheet">
    <style>
      .tab-content {
        margin: 20px;
      }
      .table-title {
        margin-bottom: 30px;
      }
      .table {
        font-size: 0.8em;
        width: 100%;
      }
      .badge-lg {
        font-size: 1.2em;
        margin: 0 0.1em 0.1em 0;
      }
      .dt-actions {
        margin-bottom: 0.5em;
      }
      .badge-ec, .badge-go {
        color: white;
        font-size: 0.75rem;
      }
      .badge-ec {
        background-color: #28a745;
      }
      .badge-go {
        background-color: #17a2b8;
      }
    </style>

    <title>CATH Pseudoenzymes: a domain-based approach to identify possible pseudoenzymes</title>

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script
      src="https://code.jquery.com/jquery-3.3.1.min.js"
      integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
      crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>

    <!-- DataTables -->
    <script type="text/javascript" src="https://cdn.datatables.net/v/bs4/dt-1.10.18/b-1.5.4/b-html5-1.5.4/datatables.min.js"></script>

  </head>
  
  <body>
    <div class="container">

      <hr /> 
      <div class="page-header">
          <h2>
              A domain-based approach to identify possible pseudoenzymes in CATH
          </h2>
          <h5>Ribeiro <i> et al </i> 2019 (paper submitted)</h5>
      </div>
      <hr />

      <p>
        We examined 383 enzyme superfamilies in CATH/Gene 3D v4.2 that contain well-known (experimentally-validated) 
        catalytic domains, and identified the proportion of functional families that have enzyme annotations and compared 
        them to those that lack any enzyme annotation. These are highly populated superfamilies accounting for 64% of sequences 
        in all CATH enzyme superfamilies and 60% of all sequences in CATH.
      </p>
      <p>A functional family was considered to have enzyme annotations if it has at least one relative that has an EC annotation 
        in UniProtKB and an experimental Gene Ontology (GO) annotation for ‘catalytic activity’. For a third of these enzyme 
        superfamilies, all functional families were annotated as enzymes. However, approximately 252 enzyme superfamilies 
        (two-thirds) had varying proportions of functional families that had no enzyme annotations in the EC classification or GO, 
        suggesting that these are very likely to be pseudoenzymes.
      </p>

      <hr />

      <div class="">
        <button class="btn btn-light" data-toggle="modal" data-target="#filter-faq1-modal"
          >How do we identify pseudoenzymes?</button>
      </div>

      <div id="filter-faq1-modal" class="modal" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-lg" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title">Identifying pseudoenzymes</h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              <p>Putative pseudoenzymes have been predicted within 252 CATH superfamilies. 
                Functional families with zero EC terms (and zero GO terms describing catalytic activity) 
                were identified within enzyme CATH superfamilies with experimentally-validated catalytic domains, 
                suggesting that these families are very likely to be potential pseudoenzymes. 
                Please note that these predictions will need to be experimentally validated to confirm 
                that they are indeed pseudoenzymes.
                </p>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            </div>
          </div>
        </div>
      </div>
  
      <hr />

    </div>
    <div class="container-fluid">

      <div class="container-fluid">

        <ul class="nav nav-tabs" id="tab-container" role="tablist">
          <li class="nav-item">
            <a class="nav-link active" data-toggle="tab" href="#summary-content" role="tab"
              >All Sfams</a>
          </li>
        </ul>
  
        <div class="tab-content">
  
          <div class="tab-pane fade show active" id="summary-content" role="tabpanel">
    
            <h5 class="table-title">Summary of 383 superfamilies in CATH (v4.2) that may contain pseudoenzyme Functional Families (FunFams)</h5>
            
            <table id="pseudo-summary-table" class="table dataTables" width="100%">
              <thead>
                <tr>
                  <th>Superfamily ID</th>
                  <th>FunFams</th>
                  <th>Sequences</th>
                  <th>FunFams With Annotations</th>
                  <th>FunFams Without Annotations</th>
                  <th>Uniq EC</th>
                  <th>Uniq GO</th>
                  <th></th>
                </tr>
              </thead>
              <tbody>
              </tbody>
              <tfoot>
                <tr>
                  <th>Superfamily ID</th>
                  <th>FunFams</th>
                  <th>Sequences</th>
                  <th>FunFams With Annotations</th>
                  <th>FunFams Without Annotations</th>
                  <th>Uniq EC</th>
                  <th>Uniq GO</th>
                  <th></th>
                </tr>
              </tfoot>
            </table>

          </div>
        </div>
  
      </div>
    </div>


    <div id="sfam-detail-modal" class="modal modal-lg" tabindex="-1" role="dialog">
      <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Title</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <div class="container-fluid">
              <table id="sfam-detail-table" class="table dataTables" width="100%">
                <thead>
                  <th>FunFam ID</th>
                  <th>Sequences</th>
                  <th># EC</th>
                  <th>EC</th>
                  <th># GO</th>
                  <th>GO</th>
                </thead>
                <tbody>
                </tbody>
                <tfoot>
                  <th>FunFam ID</th>
                  <th>Sequences</th>
                  <th># EC</th>
                  <th>EC</th>
                  <th># GO</th>
                  <th>GO</th>
                </tfoot>
              </table>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>


    <script>

$(document).ready(function() {
  var base_url = 'http://localhost:8080/';
//  var base_url = 'https://uclorengogroup.github.io/cath-pseudoenzymes/';
//  'https://raw.githubusercontent.com/UCLOrengoGroup/cath-pseudoenzyme.github.io/master'              

  var data_by_sfam = [];

  function hex_to_rgb(hex) {
    var result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
    return result ? {
      r: parseInt(result[1], 16),
      g: parseInt(result[2], 16),
      b: parseInt(result[3], 16)
    } : null;
  }

  function is_dark(c) {
    rgb = hex_to_rgb(c);
    rgb_av = (rgb.r + rgb.g + rgb.b) / 3;
    return rgb_av < (256/2);
  }

  function get_color(n) {
    var colors = ["#3366cc", "#dc3912", "#ff9900", "#109618", "#990099", "#0099c6", "#dd4477", "#66aa00", "#b82e2e", "#316395", "#994499", "#22aa99", "#aaaa11", "#6633cc", "#e67300", "#8b0707", "#651067", "#329262", "#5574a6", "#3b3eac"];
    return colors[n % colors.length];
  }

  dt_dom = '<"dt-actions"B>lfrtip'
  dt_buttons = ['copy', 'csv']


/*
  my @funfam_data = map {
        my $ff_id = $_;
        {
            funfam_id => $ff_id,
            seq_count => $acc_by_funfam{$ff_id},
            uniq_ec => [ uniq sort keys %{$ec_by_funfam{$ff_id}} ],
            uniq_go => [ uniq sort map { sprintf("%s: %s", $_->{go_acc}, $_->{name}) } values %{$go_by_funfam{$ff_id}} ],
        }
    } keys %acc_by_funfam;
    
    my %sfam_data = (
        sfam_id => $superfamily_id,
        funfam_count => (scalar keys %acc_by_funfam),
        funfam_seq_count => (sum values %acc_by_funfam),
        empty_count => $anno_empty_count,
        non_empty_count => $anno_nonempty_count,
        sfam_uniq_ec_count => scalar( uniq map { keys %$_ } (values %ec_by_funfam) ),
        sfam_uniq_go_count => scalar( uniq map { keys %$_ } (values %go_by_funfam) ),
        funfam_data => \@funfam_data,
    );
*/
    
  var summary_table = $('#pseudo-summary-table').DataTable( {
    "dom": dt_dom,
    "buttons": dt_buttons,
    "columns": [
      { "data": "sfam_id" },
      { "data": "funfam_count" },
      { "data": "funfam_seq_count" },
      { "data": "non_empty_count" },
      { "data": "empty_count" },
      { "data": "sfam_uniq_ec_count" },
      { "data": "sfam_uniq_go_count" },
      {
        "className": 'details-control',
        "orderable": false,
        "data": "sfam_id",
        "defaultContent": "",
      },
    ],
    "columnDefs": [
      {
        "targets": 0,
        "render": function(sfam_id) {
          return '<a href="http://www.cathdb.info/superfamily/' + sfam_id + '" target="_blank">' + sfam_id + '</a>'
        },
      },
      {
        "targets": 5,
        "render": function(count) { return count == 0 ? '-' : '<span class="badge badge-ec">' + count + '</span>' },
      },
      {
        "targets": 6,
        "render": function(count) { return count == 0 ? '-' : '<span class="badge badge-go">' + count + '</span>' },
      },
      {
        "targets": 7,
        "render": function(sfam_id) {
          return '<button class="btn btn-primary" data-toggle="modal" data-sfam-id="'+sfam_id+'" data-target="#sfam-detail-modal">Details</button>';
        },
      }
    ]
  });

  var details_table = $('#sfam-detail-table').DataTable({
    "dom": dt_dom,
    "buttons": dt_buttons,
    "columns": [
      { "data": "funfam_id" },
      { "data": "seq" },
      { "data": "ec", defaultContent: "" },
      { "data": "ec" },
      { "data": "go", defaultContent: "" },
      { "data": "go" },
    ],
    "columnDefs": [
      {
        "targets": [2],
        "render": function(arr) { return arr.length == 0 ? '-' : '<span class="badge badge-ec">' + arr.length + '</span>' },
      },
      {
        "targets": [4],
        "render": function(arr) { return arr.length == 0 ? '-' : '<span class="badge badge-go">' + arr.length + '</span>' },
      },
      {
        "targets": [3, 5],
        "render": function(arr) { 
          return '<ul>' + arr.map(function(id) { return '<li>' + id + '</li>' }).join('') + '</ul>';
        },
      },
    ]
  });


  $('#loading').html('Loading data ...');
  $.get( base_url + "/data/stats.v4_2_0.json", function(data) {
    $('#loading').html('');
    console.log('Loading.data: ', data);
    var row_data = data['data'];
    row_data.forEach(function(sfam_data) {
      var sfam_id = sfam_data['sfam_id'];
      data_by_sfam[sfam_id] = sfam_data;
    });
    console.log('Loading.data_by_sfam: ', data_by_sfam);
    summary_table.clear();
    summary_table.rows.add(row_data);
    summary_table.draw();
  });

  $('#sfam-detail-modal').on('show.bs.modal', function(event) {

    var button = $(event.relatedTarget);
    var sfam_id = button.data('sfamId');
    var modal = $(this);

    var sfam_data = data_by_sfam[sfam_id];
    var funfam_data = sfam_data['funfam_data']

    modal.find('.modal-title').text('Superfamily: ' + sfam_id );

    console.log("funfam_data: ", funfam_data);

    details_table.clear();
    details_table.rows.add(funfam_data);
    details_table.draw();
  });

});

    </script> 

  </body>
</html>


